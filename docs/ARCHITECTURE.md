# FinSightAI æ¶æ„è¯´æ˜

## ğŸ“ é¡¹ç›®ç»“æ„

```
FinSightAI/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ data_loader/
â”‚   â”‚   â”œâ”€â”€ pdf_parser.py          # PDF è§£æï¼ˆMinerUï¼‰
â”‚   â”‚   â”œâ”€â”€ chunk_processor.py     # æ–‡æœ¬åˆ‡åˆ†å¤„ç†å™¨ â­ æ–°å¢
â”‚   â”‚   â””â”€â”€ text_splitter.py       # Token åˆ‡åˆ†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ storage/                    # å­˜å‚¨æ¨¡å— â­ æ–°å¢
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ vector_store.py        # å‘é‡å­˜å‚¨ç®¡ç†å™¨
â”‚   â”‚
â”‚   â””â”€â”€ retrieval/
â”‚       â””â”€â”€ milvus_client.py       # Milvus å®¢æˆ·ç«¯
â”‚
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ sprint1_pipeline.py        # Sprint 1 ä¸»æµç¨‹
â”‚
â””â”€â”€ data/
    â”œâ”€â”€ raw_pdfs/                   # åŸå§‹ PDF
    â”œâ”€â”€ processed/                  # è§£æåçš„ Markdown
    â””â”€â”€ milvus_lite.db             # å‘é‡æ•°æ®åº“
```

---

## ğŸ”„ æ•°æ®å¤„ç†æµç¨‹

### å®Œæ•´æµç¨‹å›¾

```
PDF æ–‡ä»¶
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. PDF è§£æ                         â”‚
â”‚    pdf_parser.py                    â”‚
â”‚    - MinerU è§£æ PDF                â”‚
â”‚    - è¾“å‡º Markdown + å›¾ç‰‡           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ–‡æœ¬åˆ‡åˆ†                         â”‚
â”‚    chunk_processor.py â­            â”‚
â”‚    - è¯»å– Markdown æ–‡ä»¶             â”‚
â”‚    - TokenTextSplitter åˆ‡åˆ†         â”‚
â”‚    - è¾“å‡ºæ–‡æœ¬å—åˆ—è¡¨                 â”‚
â”‚    - è¯¦ç»†æ—¥å¿—è¾“å‡º                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å‘é‡åŒ–ä¸å­˜å‚¨                     â”‚
â”‚    vector_store.py â­               â”‚
â”‚    - è°ƒç”¨ SiliconFlow API           â”‚
â”‚    - æ‰¹é‡å‘é‡åŒ–ï¼ˆ64/æ‰¹ï¼‰            â”‚
â”‚    - å­˜å…¥ Milvus æ•°æ®åº“             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Milvus å‘é‡æ•°æ®åº“
```

---

## ğŸ“¦ æ ¸å¿ƒæ¨¡å—è¯´æ˜

### 1. `chunk_processor.py` - æ–‡æœ¬åˆ‡åˆ†å¤„ç†å™¨

**èŒè´£**ï¼š
- è¯»å–è§£æåçš„ Markdown æ–‡ä»¶
- ä½¿ç”¨ `FinancialTextSplitter` åˆ‡åˆ†æ–‡æœ¬
- è¾“å‡ºè¯¦ç»†çš„åˆ‡åˆ†æ—¥å¿—

**ä¸»è¦æ–¹æ³•**ï¼š
```python
class ChunkProcessor:
    def process_parsed_results(self, parsed_results) -> List[Dict]:
        """å¤„ç†è§£æç»“æœï¼Œåˆ‡åˆ†æˆæ–‡æœ¬å—"""
        # è¿”å›: [{'text': str, 'metadata': dict, 'chunk_id': int}, ...]
```

**æ—¥å¿—è¾“å‡º**ï¼š
- æ¯ä¸ªæ–‡æ¡£çš„å¤„ç†è¿›åº¦
- åŸå§‹æ–‡æœ¬é•¿åº¦
- åˆ‡åˆ†åçš„å—æ•°
- å‰ 2 ä¸ªå—çš„é¢„è§ˆ
- ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ€»åˆ‡ç‰‡æ•°ã€å¹³å‡å€¼ï¼‰

---

### 2. `vector_store.py` - å‘é‡å­˜å‚¨ç®¡ç†å™¨

**èŒè´£**ï¼š
- å°è£… Milvus å®¢æˆ·ç«¯
- è´Ÿè´£æ–‡æœ¬å‘é‡åŒ–
- ç®¡ç†å‘é‡å­˜å‚¨

**ä¸»è¦æ–¹æ³•**ï¼š
```python
class VectorStore:
    def store_chunks(self, chunks) -> bool:
        """å‘é‡åŒ–å¹¶å­˜å‚¨æ–‡æœ¬å—åˆ° Milvus"""
    
    def search(self, query, top_k=3) -> List[Dict]:
        """å‘é‡æ£€ç´¢"""
```

**ç‰¹ç‚¹**ï¼š
- è‡ªåŠ¨æ‰¹é‡å¤„ç†ï¼ˆ64 ä¸ª/æ‰¹ï¼‰
- è¯¦ç»†çš„è¿›åº¦æ—¥å¿—
- é”™è¯¯å¤„ç†

---

### 3. `sprint1_pipeline.py` - ä¸»æµç¨‹ç¼–æ’

**èŒè´£**ï¼š
- åè°ƒä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶
- æä¾›ç»Ÿä¸€çš„æ•°æ®æ‘„å–æ¥å£

**æ ¸å¿ƒç»„ä»¶**ï¼š
```python
class Sprint1Pipeline:
    def __init__(self):
        self.pdf_parser = PDFParser()        # PDF è§£æ
        self.chunk_processor = ChunkProcessor()  # æ–‡æœ¬åˆ‡åˆ† â­
        self.vector_store = VectorStore()    # å‘é‡å­˜å‚¨ â­
        self.llm = OpenAI(...)               # LLM å®¢æˆ·ç«¯
```

**ä¸»è¦æµç¨‹**ï¼š
```python
def ingest_pdfs(self, pdf_dir):
    # 1. è§£æ PDF
    parsed_results = self.pdf_parser.batch_parse(pdf_dir)
    
    # 2. æ–‡æœ¬åˆ‡åˆ†ï¼ˆç‹¬ç«‹æ¨¡å—ï¼‰
    chunks = self.chunk_processor.process_parsed_results(parsed_results)
    
    # 3. å‘é‡åŒ–å­˜å‚¨ï¼ˆç‹¬ç«‹æ¨¡å—ï¼‰
    self.vector_store.store_chunks(chunks)
```

---

## ğŸ¯ æ¨¡å—åŒ–ä¼˜åŠ¿

### âœ… èŒè´£åˆ†ç¦»
- **pdf_parser**: åªè´Ÿè´£ PDF â†’ Markdown
- **chunk_processor**: åªè´Ÿè´£ Markdown â†’ æ–‡æœ¬å—
- **vector_store**: åªè´Ÿè´£æ–‡æœ¬å— â†’ å‘é‡æ•°æ®åº“

### âœ… å¯æµ‹è¯•æ€§
æ¯ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹æµ‹è¯•ï¼š
```python
# æµ‹è¯•åˆ‡åˆ†
processor = ChunkProcessor(chunk_size=512)
chunks = processor.process_parsed_results(parsed_results)

# æµ‹è¯•å­˜å‚¨
store = VectorStore()
success = store.store_chunks(chunks)
```

### âœ… å¯å¤ç”¨æ€§
å…¶ä»–è„šæœ¬å¯ä»¥å•ç‹¬ä½¿ç”¨è¿™äº›æ¨¡å—ï¼š
```python
# åªåˆ‡åˆ†ï¼Œä¸å­˜å‚¨
from src.data_loader.chunk_processor import ChunkProcessor
processor = ChunkProcessor()
chunks = processor.process_parsed_results(results)
processor.save_chunks_to_file(chunks, "output.json")

# åªå­˜å‚¨ï¼Œä¸åˆ‡åˆ†
from src.storage.vector_store import VectorStore
store = VectorStore()
store.store_chunks(existing_chunks)
```

### âœ… æ˜“äºæ‰©å±•
- å¯ä»¥è½»æ¾æ›¿æ¢åˆ‡åˆ†ç­–ç•¥
- å¯ä»¥åˆ‡æ¢ä¸åŒçš„å‘é‡æ•°æ®åº“
- å¯ä»¥æ·»åŠ æ–°çš„å­˜å‚¨åç«¯

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´æµç¨‹
```bash
cd /home/nl/disk_8T/lys/multiagent/FinSightAI
python scripts/sprint1_pipeline.py --ingest
```

### å•ç‹¬ä½¿ç”¨åˆ‡åˆ†æ¨¡å—
```python
from src.data_loader.chunk_processor import ChunkProcessor

processor = ChunkProcessor(chunk_size=512)
chunks = processor.process_parsed_results(parsed_results)
processor.save_chunks_to_file(chunks, "./data/chunks.json")
```

### å•ç‹¬ä½¿ç”¨å­˜å‚¨æ¨¡å—
```python
from src.storage.vector_store import VectorStore

store = VectorStore("./data/milvus_lite.db")
success = store.store_chunks(chunks)
results = store.search("æ–°èƒ½æºæ±½è½¦", top_k=5)
```

---

## ğŸ“Š æ—¥å¿—è¾“å‡ºç¤ºä¾‹

```
============================================================
ğŸš€ å¼€å§‹æ•°æ®æ‘„å–æµç¨‹
============================================================

ğŸ“š Step 1: PDF è§£æï¼ˆMinerUï¼‰
============================================================
â­ï¸  è·³è¿‡å·²è§£æ: è±«èƒ½æ§è‚¡_å…³äºæŠ•èµ„å»ºè®¾å…‰å‚¨ä¸€ä½“åŒ–é¡¹ç›®.pdf
...
âœ… æˆåŠŸè§£æ 51 ä¸ª PDF æ–‡ä»¶

============================================================
âœ‚ï¸  æ–‡æœ¬åˆ‡åˆ†å¤„ç†
============================================================

ğŸ“„ [1/51] è±«èƒ½æ§è‚¡_å…³äºæŠ•èµ„å»ºè®¾å…‰å‚¨ä¸€ä½“åŒ–é¡¹ç›®.pdf
   - åŸå§‹æ–‡æœ¬é•¿åº¦: 15,234 å­—ç¬¦
   - åˆ‡åˆ†åå—æ•°: 8 ä¸ª
   - Chunk 0: è¯åˆ¸ä»£ç ï¼š001896 è¯åˆ¸ç®€ç§°ï¼šè±«èƒ½æ§è‚¡...
   - Chunk 1: å…³äºæŠ•èµ„å»ºè®¾å…‰å‚¨ä¸€ä½“åŒ–é¡¹ç›®çš„å…¬å‘Š...
   - ... è¿˜æœ‰ 6 ä¸ªå—

...

âœ… æ–‡æœ¬åˆ‡åˆ†å®Œæˆ
   - å¤„ç†æ–‡æ¡£: 51 ä¸ª
   - æ€»åˆ‡ç‰‡æ•°: 492 ä¸ª
   - å¹³å‡æ¯æ–‡æ¡£: 9.6 ä¸ªåˆ‡ç‰‡

============================================================
ğŸ”¢ å‘é‡åŒ–ä¸å­˜å‚¨
============================================================
ğŸ“Š å‡†å¤‡å‘é‡åŒ– 492 ä¸ªæ–‡æœ¬å—
ğŸ”§ æ­£åœ¨å‘é‡åŒ– 492 ä¸ªæ–‡æœ¬å—ï¼ˆåˆ† 8 æ‰¹ï¼‰...
   ğŸ“¦ æ‰¹æ¬¡ 1/8: å¤„ç† 64 ä¸ªæ–‡æœ¬
   ğŸ“¦ æ‰¹æ¬¡ 2/8: å¤„ç† 64 ä¸ªæ–‡æœ¬
   ...
âœ… æ’å…¥ 492 æ¡è®°å½•

âœ… å‘é‡åŒ–å¹¶å­˜å‚¨å®Œæˆ
   - å­˜å‚¨åˆ‡ç‰‡: 492 ä¸ª
   - æ•°æ®åº“: financial_reports

============================================================
âœ… æ•°æ®æ‘„å–å®Œæˆï¼
============================================================
   ğŸ“š è§£æPDF: 51 ä¸ª
   âœ‚ï¸  ç”Ÿæˆåˆ‡ç‰‡: 492 ä¸ª
   ğŸ’¾ å·²å­˜å…¥ Milvus æ•°æ®åº“
============================================================
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ï¼ˆ`.env`ï¼‰
```bash
SILICONFLOW_API_KEY=your_api_key
HF_HOME=/home/nl/disk_8T/lys/cache/huggingface
```

### å‚æ•°é…ç½®
```python
# åˆ‡åˆ†å‚æ•°
chunk_size = 512  # æ¯ä¸ªå—çš„æœ€å¤§ token æ•°

# å‘é‡åŒ–å‚æ•°
batch_size = 64   # API æ‰¹é‡é™åˆ¶
top_k = 3         # æ£€ç´¢è¿”å›æ•°é‡
```

---

## ğŸ“ æ€»ç»“

é€šè¿‡æ¨¡å—åŒ–é‡æ„ï¼ŒFinSightAI ç°åœ¨å…·æœ‰ï¼š
- âœ… æ¸…æ™°çš„èŒè´£åˆ†ç¦»
- âœ… è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- âœ… è‰¯å¥½çš„å¯æµ‹è¯•æ€§
- âœ… æ˜“äºæ‰©å±•å’Œç»´æŠ¤

æ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥ç‹¬ç«‹ä½¿ç”¨å’Œæµ‹è¯•ï¼Œå¤§å¤§æé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§ã€‚
